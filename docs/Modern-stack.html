<!doctype html><html lang="en"><head><meta charset="utf-8"> <title>Modern data warehouse patterns. ELT with Snowflake variants - Typhoon Orchestrator</title> <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"> <meta name="description" content="Table of contents Table of contents Leveraging semi-structured data for resilience against schema changes Real world example- Personal information Creating a view Removing a column, adding a column Doesn’t this take up more space than regular tables? Isn’t it slower..."> <meta name="theme-color" content="#ff00b4"> <link rel="alternate" href="/feed.xml" type="application/atom+xml"> <link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.png" type="image/png"><link rel="icon" href="data:image/svg+xml;utf8,%3Csvg%20width%3D'240'%20height%3D'240'%20viewBox%3D'0%200%20240%20240'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%3E%3Ctitle%3EAlmace%20Scaffolding%3C%2Ftitle%3E%3Cpath%20d%3D'M62.563%20189.292C42.669%20172.783%2030%20147.872%2030%20120c0-49.706%2040.294-90%2090-90s90%2040.294%2090%2090c0%2038.573-24.266%2071.478-58.365%2084.283L168.568%2097h-24.752l-17.804%20112.802A91.344%2091.344%200%200%201%20120%20210c-12.356%200-24.13-2.49-34.85-6.996L95.568%20137H70.816l-8.253%2052.292z'%20fill%3D'%23FF00B4'%20fill-rule%3D'evenodd'%2F%3E%3C%2Fsvg%3E" sizes="any" type="image/svg+xml"><link rel="mask-icon" href="/mask-icon.svg" color="#ff00b4"> <link rel="manifest" href="/manifest.json"> <style>:root{--fontstack-prefix:-apple-system,BlinkMacSystemFont,;--fontstack-sans-serif:"Helvetica Neue",Arial,sans-serif;--fontstack-serif:Georgia,serif;--fontstack-monospace:Menlo,Consolas,monospace;--fontstack-default:var(--fontstack-prefix) var(--fontstack-sans-serif);--font-size-base:1rem;--font-size-factor:1vw;--font-size:1.6vw;--font-features:"halt","cv01","cv02","cv03";--line-height:calc(20 / 14);--heading-letter-spacing:-.04em;--breakpoint-lg:1600px;--breakpoint-md:px;--breakpoint-sm:640px;--breakpoint-xs:400px;--space-lg:24vw;--space-md:8vw;--space-sm:4vw;--space-xs:1.2vw;--border-lg:4px;--border-md:2px;--border-sm:1px;--nav-padding:.75vmax;--nav-item-space:1.4vmax;--text-color-h:318;--text-color-s:30%;--text-color-l:10%;--text-color-hsl:var(--text-color-h),var(--text-color-s),var(--text-color-l);--text-color:hsl(var(--text-color-hsl));--text-color-0:hsla(var(--text-color-hsl), 0);--text-color-3:hsla(var(--text-color-hsl), .03);--text-color-5:hsla(var(--text-color-hsl), .05);--text-color-7:hsla(var(--text-color-hsl), .07);--text-color-10:hsla(var(--text-color-hsl), .1);--text-color-20:hsla(var(--text-color-hsl), .2);--text-color-30:hsla(var(--text-color-hsl), .3);--text-color-40:hsla(var(--text-color-hsl), .4);--text-color-50:hsla(var(--text-color-hsl), .5);--text-color-60:hsla(var(--text-color-hsl), .6);--text-color-70:hsla(var(--text-color-hsl), .7);--text-color-80:hsla(var(--text-color-hsl), .8);--text-color-90:hsla(var(--text-color-hsl), .9);--text-color-light:hsl(var(--text-color-h), var(--text-color-s), calc(var(--text-color-l) / .9));--text-color-dark:hsl(var(--text-color-h), var(--text-color-s), calc(var(--text-color-l) * .9));--link-color-h:318;--link-color-s:100%;--link-color-l:50%;--link-color-hsl:var(--link-color-h),var(--link-color-s),var(--link-color-l);--link-color:hsl(var(--link-color-hsl));--link-color-0:hsla(var(--link-color-hsl), 0);--link-color-3:hsla(var(--link-color-hsl), .03);--link-color-5:hsla(var(--link-color-hsl), .05);--link-color-7:hsla(var(--link-color-hsl), .07);--link-color-10:hsla(var(--link-color-hsl), .1);--link-color-20:hsla(var(--link-color-hsl), .2);--link-color-30:hsla(var(--link-color-hsl), .3);--link-color-40:hsla(var(--link-color-hsl), .4);--link-color-50:hsla(var(--link-color-hsl), .5);--link-color-60:hsla(var(--link-color-hsl), .6);--link-color-70:hsla(var(--link-color-hsl), .7);--link-color-80:hsla(var(--link-color-hsl), .8);--link-color-90:hsla(var(--link-color-hsl), .9);--link-color-light:hsl(var(--link-color-h), var(--link-color-s), calc(var(--link-color-l) / .9));--link-color-dark:hsl(var(--link-color-h), var(--link-color-s), calc(var(--link-color-l) * .9));--bg-color-h:318;--bg-color-s:30%;--bg-color-l:100%;--bg-color-hsl:var(--bg-color-h),var(--bg-color-s),var(--bg-color-l);--bg-color:hsl(var(--bg-color-hsl));--bg-color-0:hsla(var(--bg-color-hsl), 0);--bg-color-3:hsla(var(--bg-color-hsl), .03);--bg-color-5:hsla(var(--bg-color-hsl), .05);--bg-color-7:hsla(var(--bg-color-hsl), .07);--bg-color-10:hsla(var(--bg-color-hsl), .1);--bg-color-20:hsla(var(--bg-color-hsl), .2);--bg-color-30:hsla(var(--bg-color-hsl), .3);--bg-color-40:hsla(var(--bg-color-hsl), .4);--bg-color-50:hsla(var(--bg-color-hsl), .5);--bg-color-60:hsla(var(--bg-color-hsl), .6);--bg-color-70:hsla(var(--bg-color-hsl), .7);--bg-color-80:hsla(var(--bg-color-hsl), .8);--bg-color-90:hsla(var(--bg-color-hsl), .9);--bg-color-light:hsl(var(--bg-color-h), var(--bg-color-s), calc(var(--bg-color-l) / .9));--bg-color-dark:hsl(var(--bg-color-h), var(--bg-color-s), calc(var(--bg-color-l) * .9));--code-color-h:calc(var(--link-color-h) + 30);--code-color-s:calc(var(--link-color-s) * .2 + 30%);--code-color-l:var(--link-color-l);--code-color-hsl:var(--code-color-h),var(--code-color-s),var(--code-color-l);--code-color:hsl(var(--code-color-hsl));--code-color-0:hsla(var(--code-color-hsl), 0);--code-color-3:hsla(var(--code-color-hsl), .03);--code-color-5:hsla(var(--code-color-hsl), .05);--code-color-7:hsla(var(--code-color-hsl), .07);--code-color-10:hsla(var(--code-color-hsl), .1);--code-color-20:hsla(var(--code-color-hsl), .2);--code-color-30:hsla(var(--code-color-hsl), .3);--code-color-40:hsla(var(--code-color-hsl), .4);--code-color-50:hsla(var(--code-color-hsl), .5);--code-color-60:hsla(var(--code-color-hsl), .6);--code-color-70:hsla(var(--code-color-hsl), .7);--code-color-80:hsla(var(--code-color-hsl), .8);--code-color-90:hsla(var(--code-color-hsl), .9);--code-color-light:hsl(var(--code-color-h), var(--code-color-s), calc(var(--code-color-l) / .9));--code-color-dark:hsl(var(--code-color-h), var(--code-color-s), calc(var(--code-color-l) * .9))}*,::after,::before{padding:0;margin:0;box-sizing:border-box}html{font-size:100%;-webkit-text-size-adjust:none;-moz-text-size-adjust:none;text-size-adjust:none;text-rendering:optimizelegibility;image-rendering:optimizequality;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background:var(--bg-color)}body{--space-body:var(--space-lg);padding-top:0;padding-bottom:0;padding-left:var(--space-body);padding-right:var(--space-body);margin:0 auto 0;font-family:var(--fontstack-default);font-size:var(--font-size);-webkit-font-feature-settings:var(--font-features);font-feature-settings:var(--font-features);line-height:var(--line-height);hanging-punctuation:first allow-end;color:var(--text-color);background:var(--bg-color);transition:all .2s ease}@media(max-width:px){body{--space-body:var(--space-md);font-size:calc(var(--font-size)*1.4)}}@media(max-width:640px){body{--space-body:var(--space-sm);font-size:calc(var(--font-size)*2.4)}}@media(max-width:400px){body{font-size:calc(var(--font-size)*3.2)}}button{color:inherit;font-family:inherit;font-size:inherit;line-height:inherit}button{background-image:none}a,button{color:var(--text-color);text-decoration:none;transition:color .5s ease,border-color .5s ease,background .5s ease,opacity 1.5s ease}a:focus,a:hover,button:focus,button:hover{transition:color .1s ease,border-color .1s ease,background .1s ease,opacity .1s ease;text-decoration:underline}button{-webkit-appearance:none;appearance:none;cursor:pointer;background:0 0;border:none;outline:0}img{border:0}::-webkit-input-placeholder{color:var(--text-color);opacity:.2}:-ms-input-placeholder{color:var(--text-color);opacity:.2}:focus::-webkit-input-placeholder{color:var(--link-color)}:focus:-ms-input-placeholder{color:var(--link-color)}.navigation{padding-top:var(--nav-padding);padding-bottom:var(--nav-padding);margin-right:calc(var(--nav-item-space)*-1);margin-left:calc(var(--nav-item-space)*-1);font-size:90%;font-weight:700}.navigation li{display:inline-block;line-height:2}.navigation li a{padding:.5em var(--nav-item-space)}.navigation li a:focus,.navigation li a:hover{color:var(--link-color);text-decoration:none}.content::after,.content::before{display:table;content:""}.content::after{clear:both}.content article>:last-child{margin-bottom:0!important}.content article>:last-child>:last-child{margin-bottom:0!important}.content article>:last-child>:last-child>:last-child{margin-bottom:0!important}.content article>:last-child>:last-child>:last-child>:last-child{margin-bottom:0!important}.content .post-content>:first-child{margin-top:0}.content a{font-weight:700}.content a:has(>code){-webkit-text-decoration-color:var(--code-color);text-decoration-color:var(--code-color)}.content p{margin-bottom:1.6rem;line-height:calc(var(--line-height)*1.2)}.content header{--header-height:100vh;--space-header:var(--space-lg);display:flex;min-height:calc(var(--header-height) - var(--nav-padding)*4 - var(--nav-item-space)*4 - 1.8ex);padding-top:10vmin;padding-bottom:10vmin;margin-bottom:16vmin;flex-direction:column;justify-content:center;background:var(--text-color-3);padding-left:var(--space-header);padding-right:var(--space-header);margin-left:calc(var(--space-header)*-1);margin-right:calc(var(--space-header)*-1)}@media(max-width:px){.content header{--header-height:70vh;--space-header:var(--space-md);padding-top:16vmin;padding-bottom:16vmin}}@media(max-width:640px){.content header{--space-header:var(--space-sm)}}.content header h1{font-size:360%;font-weight:700;letter-spacing:var(--heading-letter-spacing);margin-left:-2px;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.1}@media(max-width:640px){.content header h1{font-size:280%}}.content header small{display:block;margin-top:2vmin}.content h2,.content h3,.content h4{margin:10vmin 0 1rem;font-size:72%;font-weight:400;opacity:.5}.content ul{margin-bottom:1.8rem;list-style:none;counter-reset:list}@media(max-width:640px){.content ul{margin-left:1em}}.content ul li{line-height:calc(var(--line-height)*1.2)}.content ul li::before{position:absolute;display:flex;justify-content:flex-end;width:4em;margin-top:0;margin-left:-4em;text-align:right;opacity:.4;pointer-events:none}.content ul li>ul{margin-left:1em;margin-bottom:0}.content ul li::before{content:"-";padding-right:.5em}.content blockquote{position:relative;margin-bottom:2.8rem;margin-left:calc(var(--space-xs)*-1);font-size:90%}@media(max-width:640px){.content blockquote{margin-left:0}}.content blockquote>p{padding-left:var(--space-xs);border-left:var(--border-md) solid;color:var(--text-color-60);padding-bottom:1.6em;margin-bottom:0}.content blockquote>p:last-of-type{padding-bottom:0;margin-bottom:.4em}@media(max-width:640px){.content blockquote>p{padding-left:calc(var(--space-sm) - var(--border-md));padding-right:var(--space-sm);margin-left:calc(var(--space-sm)*-1);margin-right:calc(var(--space-sm)*-1)}}.content code,.content pre{font-family:var(--fontstack-monospace);color:var(--code-color)}.content pre{background:var(--code-color-5)}.content code{font-size:92%;overflow-wrap:break-word}.content .highlight>pre,.content .highlighter-rouge pre.highlight,.content pre{--space-code:var(--space-xs);padding-top:var(--space-xs);padding-bottom:var(--space-xs);padding-left:var(--space-code);padding-right:var(--space-code);margin-left:calc(var(--space-code)*-1);margin-right:calc(var(--space-code)*-1);margin-bottom:1.8rem;overflow-x:auto;font-size:80%;line-height:calc(var(--line-height)*1.2);-webkit-overflow-scrolling:touch}@media(max-width:px){.content .highlight>pre,.content .highlighter-rouge pre.highlight,.content pre{--space-code:var(--space-md)}}@media(max-width:640px){.content .highlight>pre,.content .highlighter-rouge pre.highlight,.content pre{--space-code:var(--space-sm)}}.content .highlight>pre code,.content .highlighter-rouge pre.highlight code,.content pre code{overflow-wrap:normal}.content table{--space-table:var(--space-xs);width:calc(100% + var(--space-table)*2);border-collapse:collapse;border-spacing:0;font-size:90%;margin-left:calc(var(--space-table)*-1);margin-right:calc(var(--space-table)*-1);margin-bottom:1.8rem}@media(max-width:px){.content table{--space-table:var(--space-md)}}@media(max-width:640px){.content table{--space-table:var(--space-sm)}}.content table td,.content table th{--space-table-cell:var(--space-xs);padding:.6em var(--space-xs)}.content table td:first-child,.content table th:first-child{padding-left:var(--space-table-cell)}.content table td:last-child,.content table th:last-child{padding-right:var(--space-table-cell)}@media(max-width:px){.content table td,.content table th{--space-table-cell:var(--space-md)}}@media(max-width:640px){.content table td,.content table th{--space-table-cell:var(--space-sm)}}.content table th{border-bottom:var(--border-md) solid var(--text-color-5);text-align:left}.content table td{border-top:var(--border-sm) solid var(--text-color-5)}.post-modified-date{font-size:75%;opacity:.5}@media only percy{.post-modified-date{display:none}}.list{display:block;margin:0 0 .4rem}@media print{*,::after,::before{background:rgba(0,0,0,0)!important;color:#000!important;box-shadow:none!important;text-shadow:none!important}body{padding:10mm!important;margin:0!important;font-size:calc(var(--font-size)*1.35)}a,a:visited{text-decoration:none}.content header{min-height:0;padding-bottom:0}.content .post-content{max-width:100%!important}.content .post-content a[href]::after{content:" (" attr(href) ")";font-weight:400;opacity:.5}.content .post-content a[href^="#"]::after{content:""}blockquote,pre{page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,h4,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}.navigation{display:none}}:root{--rdmz-h:var(--code-color-h, 254);--rdmz-s:var(--code-color-s, 80%);--rdmz-l:var(--code-color-l, 39%)}.highlight>pre,.highlighter-rouge pre.highlight{background:hsla(var(--rdmz-h),var(--rdmz-s),var(--rdmz-l),.03)}.highlight .err,.highlighter-rouge .err{background-color:hsla(var(--rdmz-h),calc(var(--rdmz-s) * 2),var(--rdmz-l),.1)}.highlight .c1,.highlighter-rouge .c1{font-style:italic}.highlight .o,.highlighter-rouge .o{font-weight:700}.highlight .k,.highlighter-rouge .k{font-weight:700}.highlight code,.highlight pre,.highlighter-rouge code,.highlighter-rouge pre{--rdmz-h-local:var(--rdmz-h);color:hsl(var(--rdmz-h),var(--rdmz-s),var(--rdmz-l))}.highlight .err,.highlighter-rouge .err{--rdmz-h-local:calc(var(--rdmz-h) + 5.3731343284);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .n,.highlighter-rouge .n{--rdmz-h-local:calc(var(--rdmz-h) + 16.1194029851);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .nb,.highlighter-rouge .nb{--rdmz-h-local:calc(var(--rdmz-h) + 26.8656716418);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .k,.highlighter-rouge .k{--rdmz-h-local:calc(var(--rdmz-h) + 177.3134328358);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .s1,.highlighter-rouge .s1{--rdmz-h-local:calc(var(--rdmz-h) + 290.1492537313);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .mi,.highlighter-rouge .mi{--rdmz-h-local:calc(var(--rdmz-h) + 317.0149253731);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .o,.highlighter-rouge .o{--rdmz-h-local:calc(var(--rdmz-h) + 343.8805970149);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .p,.highlighter-rouge .p{--rdmz-h-local:calc(var(--rdmz-h) + 354.6268656716);color:hsl(var(--rdmz-h-local),var(--rdmz-s),var(--rdmz-l))}.highlight .c1,.highlighter-rouge .c1{color:hsla(calc(var(--rdmz-h) + 26.8656716418),calc(var(--rdmz-s) * .7),var(--rdmz-l),.6)}:root{--font-size:1.5vw;--space-lg:0;--bg-color-h:168;--bg-color-s:100%;--bg-color-l:25%;--bg-color-hsl:var(--bg-color-h),var(--bg-color-s),var(--bg-color-l);--bg-color:hsl(var(--bg-color-hsl));--bg-color-light:hsl(var(--bg-color-h), var(--bg-color-s), calc(var(--bg-color-l) ));--bg-color-dark:hsl(var(--bg-color-h), var(--bg-color-s), calc(var(--bg-color-l) ));--text-color:white;--link-color-h:220;--link-color-s:100%;--link-color-l:85%;--link-color-hsl:var(--link-color-h),var(--link-color-s),var(--link-color-l);--link-color:hsl(var(--link-color-hsl))}.content header{background-color:#003329;flex-direction:inherit;display:flow-root;padding-left:20%}@media(max-width:767.98px){.content header{--header-height:unset}}.content h1{font-weight:700!important;font-size:48px!important;line-height:150%!important;opacity:1!important}@media(max-width:479.98px){.content h1{font-size:24px!important}}@media(max-width:767.98px){.content h1{font-size:32px!important}}@media(max-width:479.98px){.content h1{font-size:32px!important}}.content h2{font-weight:600!important;font-size:44px!important;line-height:100%!important;opacity:1!important}@media(max-width:479.98px){.content h2{font-size:24px!important}}@media(max-width:767.98px){.content h2{font-size:32px!important}}@media(max-width:479.98px){.content h2{font-size:32px!important}}.content h3{font-style:normal;font-weight:600!important;font-size:40px!important;line-height:150%!important;opacity:1!important}@media(max-width:479.98px){.content h3{font-size:24px!important}}.content h4{font-weight:600!important;font-size:24px!important;opacity:1!important;line-height:150%!important}@media(max-width:479.98px){.content h4{font-size:16px!important}}.content p{line-height:150%!important;font-size:20px!important}@media(max-width:479.98px){.content p{font-size:16px!important}}.highlight .err,.highlighter-rouge .err{color:unset;background-color:unset}*{padding:0;margin:0;border:0}*,:after,:before{box-sizing:border-box}body,html{height:100%;background-color:#123229;min-width:360px}body{color:#fff;line-height:1;font-family:Roboto;font-size:18px;-ms-text-size-adjust:100%;-moz-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:0!important}button{font-family:Roboto;font-size:inherit}button{cursor:pointer;color:inherit;background-color:inherit}a{color:inherit}a:link,ul li{list-style:none}img{vertical-align:top}h1,h2,h3,h4{font-weight:inherit;font-size:inherit}[class*=__container]{max-width:1172px;box-sizing:content-box;margin:0 auto;padding:0 50px}@media(max-width:479.98px){[class*=__container]{padding:0 35px}}[class*=post-content]{color:#000;background-color:#f5f5f5;max-width:1172px;box-sizing:content-box;margin:0 auto;padding:50px 50px}@media(max-width:479.98px){[class*=post-content]{padding:35px 35px}}[class*=post-content] .highlight{background-color:#000;padding-left:20px}[class*=post-content] p code{color:green}article header h1{width:50%}@media(max-width:767.98px){article header h1{width:90%}}.title{font-style:normal;font-weight:700!important;font-size:40px!important;line-height:150%;opacity:1!important}@media(max-width:479.98px){.title{font-size:24px!important}}.title_big{font-size:48px;line-height:100%}@media(max-width:767.98px){.title_big{font-size:32px}}@media(max-width:479.98px){.title_big{font-size:32px}}.title_uppercase{text-transform:uppercase}.subtitle{font-style:normal;font-weight:600;font-size:24px!important;opacity:1!important;line-height:150%}@media(max-width:479.98px){.subtitle{font-size:16px!important}}.text{line-height:150%}@media(max-width:479.98px){.text{font-size:16px}}.header-site{background-color:#377e67;overflow:hidden}.menu-header{display:flex;min-height:60px;align-items:center;justify-content:space-between}@media(max-width:767.98px){.menu-header{min-height:60px}}.menu-header__logo{position:relative}@media(max-width:767.98px){.menu-header__logo{z-index:102;left:35px}}.menu-header__logo img{width:120%}.menu-header__list{display:flex;gap:38px}@media(max-width:767.98px){.menu-header__list{position:fixed;background:#377e67;left:0;top:0;height:100vh;width:100vw;display:none}}.menu-header__burger-menu{display:none;cursor:pointer}@media(max-width:767.98px){.menu-header__burger-menu{display:block;position:relative;height:20px;width:26px;z-index:102;cursor:pointer}.menu-header__burger-menu:after,.menu-header__burger-menu:before{content:"";position:absolute;right:0;height:2px;width:100%;background:#000;transition:cubic-bezier(.785,.135,.15,.86) .3s all}.menu-header__burger-menu:before{top:0}.menu-header__burger-menu::after{bottom:0}.menu-header__burger-menu span{position:absolute;top:9px;right:0;width:100%;background:#000;height:2px;-webkit-transform:scale(1);transform:scale(1);transition:cubic-bezier(.785,.135,.15,.86) .3s all}}.content{margin-bottom:0!important}.posts-home{padding:120px 0}@media(max-width:1171.98px){.posts-home{padding:100px 0}}@media(max-width:991.98px){.posts-home{padding:80px 0}}@media(max-width:767.98px){.posts-home{padding:60px 0}}.posts-home__body{display:flex;justify-content:space-between}@media(max-width:991.98px){.posts-home__body{flex-direction:column}}.posts-home__title{text-align:center;margin:0!important}.posts-home__subtitle{margin:56px 0!important;font-weight:700!important;font-size:32px!important;line-height:150%;color:#95fce2}@media(max-width:991.98px){.posts-home__subtitle{margin:35px 0!important;font-size:24px!important}}.posts-home__links{display:flex;align-items:flex-start;justify-content:space-between;flex-direction:column;row-gap:24px}@media(max-width:991.98px){.posts-home__links{align-items:center;row-gap:15px}}.posts-home__link{font-weight:500;font-size:24px;line-height:150%}@media(max-width:991.98px){.posts-home__link{font-size:18px}}.item-posts-left{width:40%}@media(max-width:991.98px){.item-posts-left{text-align:center}}.item-posts-right{width:40%}@media(max-width:991.98px){.item-posts-right{text-align:center}}</style> <link rel="canonical" href="https://typhoondata.io/Modern-stack.html"> <meta property="og:type" content="article"> <meta property="og:site_name" content="Typhoon Orchestrator"> <meta property="og:title" content="Modern data warehouse patterns. ELT with Snowflake variants"> <meta property="og:url" content="https://typhoondata.io/Modern-stack.html"> <meta property="og:description" content="Table of contents Table of contents Leveraging semi-structured data for resilience against schema changes Real world example- Personal information Creating a view Removing a column, adding a column Doesn’t this take up more space than regular tables? Isn’t it slower..."> <meta property="og:image" content="https://res.cloudinary.com/practicaldev/image/fetch/s--HQh30rs7--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/o1zxpq2orcx5c727lul4.jpeg"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="@typhoondata"> <meta name="twitter:creator" content="@datatyphoon"> <meta property="article:published_time" content="2022-07-01T00:00:00-07:00"> <meta property="article:modified_time" content="2022-07-17T04:34:46-07:00"> <meta name="twitter:label1" value="Words"> <meta name="twitter:data1" value="1906 words"> <meta name="twitter:label2" value="Reading time"> <meta name="twitter:data2" value="9 mins"> </head><body><div class="header-site"> <div class="heder__body"> <div class="header__container"> <nav class="navigation header__menu menu-header"> <div class="menu-header__logo"><a href="https://typhoon-data-org.github.io/website"><img src="data:image/svg+xml;utf8,%3Csvg%20width%3D'94'%20height%3D'22'%20viewBox%3D'0%200%2094%2022'%20fill%3D'none'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%3E%3Cpath%20d%3D'M0.639205%207.19105V4.90909H11.3906V7.19105H7.38281V18H4.64702V7.19105H0.639205ZM24.1933%2018V4.90909H29.358C30.3509%204.90909%2031.1968%205.09872%2031.8957%205.47798C32.5945%205.85298%2033.1272%206.375%2033.4937%207.04403C33.8644%207.70881%2034.0498%208.47585%2034.0498%209.34517C34.0498%2010.2145%2033.8623%2010.9815%2033.4873%2011.6463C33.1123%2012.3111%2032.569%2012.8288%2031.8573%2013.1996C31.1499%2013.5703%2030.2934%2013.7557%2029.2877%2013.7557H25.9958V11.5376H28.8403C29.3729%2011.5376%2029.8119%2011.446%2030.157%2011.2628C30.5065%2011.0753%2030.7664%2010.8175%2030.9369%2010.4893C31.1116%2010.157%2031.1989%209.77557%2031.1989%209.34517C31.1989%208.91051%2031.1116%208.53125%2030.9369%208.20739C30.7664%207.87926%2030.5065%207.62571%2030.157%207.44673C29.8076%207.26349%2029.3644%207.17188%2028.8275%207.17188H26.961V18H24.1933ZM36.7475%2018V4.90909H39.5153V10.3104H45.1339V4.90909H47.8953V18H45.1339V12.5923H39.5153V18H36.7475ZM63.1071%2011.4545C63.1071%2012.8821%2062.8365%2014.0966%2062.2953%2015.098C61.7583%2016.0994%2061.0254%2016.8643%2060.0964%2017.3928C59.1717%2017.9169%2058.1319%2018.179%2056.9771%2018.179C55.8137%2018.179%2054.7697%2017.9148%2053.845%2017.3864C52.9203%2016.858%2052.1895%2016.093%2051.6525%2015.0916C51.1156%2014.0902%2050.8471%2012.8778%2050.8471%2011.4545C50.8471%2010.027%2051.1156%208.8125%2051.6525%207.81108C52.1895%206.80966%2052.9203%206.04687%2053.845%205.52273C54.7697%204.99432%2055.8137%204.73011%2056.9771%204.73011C58.1319%204.73011%2059.1717%204.99432%2060.0964%205.52273C61.0254%206.04687%2061.7583%206.80966%2062.2953%207.81108C62.8365%208.8125%2063.1071%2010.027%2063.1071%2011.4545ZM60.301%2011.4545C60.301%2010.5298%2060.1625%209.75%2059.8855%209.11506C59.6127%208.48011%2059.2271%207.99858%2058.7285%207.67045C58.2299%207.34233%2057.6461%207.17827%2056.9771%207.17827C56.3081%207.17827%2055.7243%207.34233%2055.2257%207.67045C54.7271%207.99858%2054.3393%208.48011%2054.0623%209.11506C53.7896%209.75%2053.6532%2010.5298%2053.6532%2011.4545C53.6532%2012.3793%2053.7896%2013.1591%2054.0623%2013.794C54.3393%2014.429%2054.7271%2014.9105%2055.2257%2015.2386C55.7243%2015.5668%2056.3081%2015.7308%2056.9771%2015.7308C57.6461%2015.7308%2058.2299%2015.5668%2058.7285%2015.2386C59.2271%2014.9105%2059.6127%2014.429%2059.8855%2013.794C60.1625%2013.1591%2060.301%2012.3793%2060.301%2011.4545ZM78.0871%2011.4545C78.0871%2012.8821%2077.8166%2014.0966%2077.2754%2015.098C76.7384%2016.0994%2076.0055%2016.8643%2075.0765%2017.3928C74.1518%2017.9169%2073.112%2018.179%2071.9572%2018.179C70.7938%2018.179%2069.7498%2017.9148%2068.8251%2017.3864C67.9004%2016.858%2067.1695%2016.093%2066.6326%2015.0916C66.0957%2014.0902%2065.8272%2012.8778%2065.8272%2011.4545C65.8272%2010.027%2066.0957%208.8125%2066.6326%207.81108C67.1695%206.80966%2067.9004%206.04687%2068.8251%205.52273C69.7498%204.99432%2070.7938%204.73011%2071.9572%204.73011C73.112%204.73011%2074.1518%204.99432%2075.0765%205.52273C76.0055%206.04687%2076.7384%206.80966%2077.2754%207.81108C77.8166%208.8125%2078.0871%2010.027%2078.0871%2011.4545ZM75.281%2011.4545C75.281%2010.5298%2075.1425%209.75%2074.8656%209.11506C74.5928%208.48011%2074.2072%207.99858%2073.7086%207.67045C73.21%207.34233%2072.6262%207.17827%2071.9572%207.17827C71.2881%207.17827%2070.7043%207.34233%2070.2058%207.67045C69.7072%207.99858%2069.3194%208.48011%2069.0424%209.11506C68.7697%209.75%2068.6333%2010.5298%2068.6333%2011.4545C68.6333%2012.3793%2068.7697%2013.1591%2069.0424%2013.794C69.3194%2014.429%2069.7072%2014.9105%2070.2058%2015.2386C70.7043%2015.5668%2071.2881%2015.7308%2071.9572%2015.7308C72.6262%2015.7308%2073.21%2015.5668%2073.7086%2015.2386C74.2072%2014.9105%2074.5928%2014.429%2074.8656%2013.794C75.1425%2013.1591%2075.281%2012.3793%2075.281%2011.4545ZM91.987%204.90909V18H89.5963L83.901%209.76065H83.8052V18H81.0374V4.90909H83.4664L89.1169%2013.142H89.232V4.90909H91.987Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M21.9123%205H13.9875C13.5748%205%2013.2402%205.35775%2013.2402%205.79905V5.84106C13.2402%206.28236%2013.5748%206.64011%2013.9875%206.64011H21.9123C22.325%206.64011%2022.6596%206.28236%2022.6596%205.84106V5.79905C22.6596%205.35775%2022.325%205%2021.9123%205Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M20.7924%206.94557H13.6849C13.3066%206.94557%2013%207.2735%2013%207.67803V7.71654C13%208.12107%2013.3066%208.449%2013.6849%208.449H20.7924C21.1707%208.449%2021.4774%208.12107%2021.4774%207.71654V7.67803C21.4774%207.2735%2021.1707%206.94557%2020.7924%206.94557Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M20.4936%208.75449H14.6745C14.3306%208.75449%2014.0518%209.05261%2014.0518%209.42035V9.45536C14.0518%209.82311%2014.3306%2010.1212%2014.6745%2010.1212H20.4936C20.8375%2010.1212%2021.1163%209.82311%2021.1163%209.45536V9.42035C21.1163%209.05261%2020.8375%208.75449%2020.4936%208.75449Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M20.9879%2010.4267H15.9862C15.6767%2010.4267%2015.4258%2010.695%2015.4258%2011.026V11.0575C15.4258%2011.3885%2015.6767%2011.6568%2015.9862%2011.6568H20.9879C21.2974%2011.6568%2021.5483%2011.3885%2021.5483%2011.0575V11.026C21.5483%2010.695%2021.2974%2010.4267%2020.9879%2010.4267Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M20.9237%2011.9623H16.7394C16.4643%2011.9623%2016.2412%2012.2008%2016.2412%2012.495V12.523C16.2412%2012.8172%2016.4643%2013.0557%2016.7394%2013.0557H20.9237C21.1988%2013.0557%2021.4219%2012.8172%2021.4219%2012.523V12.495C21.4219%2012.2008%2021.1988%2011.9623%2020.9237%2011.9623Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M19.3514%2013.3612H16.4554C16.2147%2013.3612%2016.0195%2013.5699%2016.0195%2013.8273V13.8518C16.0195%2014.1092%2016.2147%2014.3179%2016.4554%2014.3179H19.3514C19.5921%2014.3179%2019.7873%2014.1092%2019.7873%2013.8518V13.8273C19.7873%2013.5699%2019.5921%2013.3612%2019.3514%2013.3612Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.8492%2014.6234H16.7706C16.5643%2014.6234%2016.397%2014.8022%2016.397%2015.0229V15.0439C16.397%2015.2646%2016.5643%2015.4434%2016.7706%2015.4434H18.8492C19.0555%2015.4434%2019.2227%2015.2646%2019.2227%2015.0439V15.0229C19.2227%2014.8022%2019.0555%2014.6234%2018.8492%2014.6234Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.5579%2015.7489H17.2967C17.1247%2015.7489%2016.9854%2015.898%2016.9854%2016.0818V16.0993C16.9854%2016.2832%2017.1247%2016.4323%2017.2967%2016.4323H18.5579C18.7299%2016.4323%2018.8692%2016.2832%2018.8692%2016.0993V16.0818C18.8692%2015.898%2018.7299%2015.7489%2018.5579%2015.7489Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.3334%2016.7377H17.7955C17.6579%2016.7377%2017.5464%2016.857%2017.5464%2017.0041V17.0181C17.5464%2017.1652%2017.6579%2017.2844%2017.7955%2017.2844H18.3334C18.471%2017.2844%2018.5825%2017.1652%2018.5825%2017.0181V17.0041C18.5825%2016.857%2018.471%2016.7377%2018.3334%2016.7377Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.589%2017.59H18.2561C18.1529%2017.59%2018.0693%2017.6794%2018.0693%2017.7897V17.8002C18.0693%2017.9105%2018.1529%2018%2018.2561%2018H18.589C18.6922%2018%2018.7758%2017.9105%2018.7758%2017.8002V17.7897C18.7758%2017.6794%2018.6922%2017.59%2018.589%2017.59Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M22.659%205.79905C22.659%205.35775%2022.3751%205%2022.0248%205C21.6746%205%2021.3906%205.35775%2021.3906%205.79905V5.84106C21.3906%206.28236%2021.6746%206.64011%2022.0248%206.64011C22.3751%206.64011%2022.659%206.28236%2022.659%205.84106V5.79905Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M14.7088%205.79905C14.7088%205.35775%2014.4249%205%2014.0746%205C13.7244%205%2013.4404%205.35775%2013.4404%205.79905V5.84106C13.4404%206.28236%2013.7244%206.64011%2014.0746%206.64011C14.4249%206.64011%2014.7088%206.28236%2014.7088%205.84106V5.79905Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M13.9637%206.94557H13.6849C13.3066%206.94557%2013%207.2735%2013%207.67803V7.71654C13%208.12107%2013.3066%208.449%2013.6849%208.449H13.9637C14.342%208.449%2014.6487%208.12107%2014.6487%207.71654V7.67803C14.6487%207.2735%2014.342%206.94557%2013.9637%206.94557Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M21.3425%207.74036C21.3425%207.33584%2021.09%207.0079%2020.7784%207.0079C20.4669%207.0079%2020.2144%207.33584%2020.2144%207.74036V7.77887C20.2144%208.1834%2020.4669%208.51133%2020.7784%208.51133C21.09%208.51133%2021.3425%208.1834%2021.3425%207.77887V7.74036Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M15.6407%208.69536H15.1432C14.7993%208.69536%2014.5205%208.99348%2014.5205%209.36123V9.39625C14.5205%209.764%2014.7993%2010.0621%2015.1432%2010.0621H15.6407C15.9846%2010.0621%2016.2634%209.764%2016.2634%209.39625V9.36123C16.2634%208.99348%2015.9846%208.69536%2015.6407%208.69536Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M20.8034%209.42035C20.8034%209.05261%2020.553%208.75449%2020.2442%208.75449C19.9354%208.75449%2019.6851%209.05261%2019.6851%209.42035V9.45536C19.6851%209.82311%2019.9354%2010.1212%2020.2442%2010.1212C20.553%2010.1212%2020.8034%209.82311%2020.8034%209.45536V9.42035Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M19.05%2010.4267H17.7123C17.4027%2010.4267%2017.1519%2010.695%2017.1519%2011.026V11.0575C17.1519%2011.3885%2017.4027%2011.6568%2017.7123%2011.6568H19.05C19.3595%2011.6568%2019.6104%2011.3885%2019.6104%2011.0575V11.026C19.6104%2010.695%2019.3595%2010.4267%2019.05%2010.4267Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M19.0532%2011.9623H18.4767C18.2016%2011.9623%2017.9785%2012.2008%2017.9785%2012.495V12.523C17.9785%2012.8172%2018.2016%2013.0557%2018.4767%2013.0557H19.0532C19.3284%2013.0557%2019.5513%2012.8172%2019.5513%2012.523V12.495C19.5513%2012.2008%2019.3284%2011.9623%2019.0532%2011.9623Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M19.351%2013.3612H18.8602C18.6194%2013.3612%2018.4243%2013.5699%2018.4243%2013.8273V13.8518C18.4243%2014.1092%2018.6194%2014.3179%2018.8602%2014.3179H19.351C19.5917%2014.3179%2019.7869%2014.1092%2019.7869%2013.8518V13.8273C19.7869%2013.5699%2019.5917%2013.3612%2019.351%2013.3612Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.8493%2014.6234H18.6446C18.4383%2014.6234%2018.271%2014.8022%2018.271%2015.0229V15.0439C18.271%2015.2646%2018.4383%2015.4434%2018.6446%2015.4434H18.8493C19.0557%2015.4434%2019.223%2015.2646%2019.223%2015.0439V15.0229C19.223%2014.8022%2019.0557%2014.6234%2018.8493%2014.6234Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.8687%2016.0818C18.8687%2015.898%2018.7383%2015.7489%2018.5774%2015.7489C18.4166%2015.7489%2018.2861%2015.898%2018.2861%2016.0818V16.0993C18.2861%2016.2832%2018.4166%2016.4323%2018.5774%2016.4323C18.7383%2016.4323%2018.8687%2016.2832%2018.8687%2016.0993V16.0818Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.5839%2017.0041C18.5839%2016.857%2018.5006%2016.7377%2018.3977%2016.7377C18.2948%2016.7377%2018.2114%2016.857%2018.2114%2017.0041V17.0181C18.2114%2017.1652%2018.2948%2017.2844%2018.3977%2017.2844C18.5006%2017.2844%2018.5839%2017.1652%2018.5839%2017.0181V17.0041Z'%20fill%3D'white'%2F%3E%3Cpath%20d%3D'M18.775%2017.7897C18.775%2017.6794%2018.6956%2017.59%2018.5975%2017.59C18.4995%2017.59%2018.4199%2017.6794%2018.4199%2017.7897V17.8002C18.4199%2017.9105%2018.4995%2018%2018.5975%2018C18.6956%2018%2018.775%2017.9105%2018.775%2017.8002V17.7897Z'%20fill%3D'white'%2F%3E%3C%2Fsvg%3E" alt="Logo"></a></div> <ul class="menu-header__list"> <li> <a href="/#features" target="">Features</a> </li> <li> <a href="/#plugins" target="">Plugins</a> </li> <li> <a href="/#blog" target="">Blog</a> </li> <li> <a href="https://typhoon-data-org.github.io/typhoon-orchestrator/getting-started/installation/" target="_blank">Docs</a> </li> <li><iframe src="https://ghbtns.com/github-btn.html?user=typhoon-data-org&amp;repo=typhoon-orchestrator&amp;type=star&amp;count=true&amp;size=large" frameborder="0" scrolling="0" width="170" height="30" title="Star"></iframe></li> </ul> <button type="button" class="menu-header__burger-menu"><span></span></button> </nav> </div> </div> </div> <main class="content" role="main"> <article lang="en"> <header style="background-image:url(https://res.cloudinary.com/practicaldev/image/fetch/s--HQh30rs7--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/o1zxpq2orcx5c727lul4.jpeg);background-color:#fff;background-size:cover;background-position:center center;background-repeat:no-repeat;color:#000"> <h1 title="Modern data warehouse patterns. ELT with Snowflake variants" data-title="Modern data warehouse patterns. ELT with Snowflake variants"> Modern data warehouse patterns. ELT with Snowflake variants<span class="dot dot--post"> </span> </h1> <small> By <span rel="author">biellls</span> on <time datetime="2022-07-01T00:00:00-07:00">Jul 1, 2022</time> </small> </header> <div class="post-content"> <h4 id="table-of-contents">Table of contents</h4> <ul id="markdown-toc"> <li><a href="#table-of-contents" id="markdown-toc-table-of-contents">Table of contents</a></li> <li><a href="#leveraging-semi-structured-data-for-resilience-against-schema-changes" id="markdown-toc-leveraging-semi-structured-data-for-resilience-against-schema-changes">Leveraging semi-structured data for resilience against schema changes</a></li> <li><a href="#real-world-example--personal-information" id="markdown-toc-real-world-example--personal-information">Real world example- Personal information</a> <ul> <li><a href="#creating-a-view" id="markdown-toc-creating-a-view">Creating a view</a></li> <li><a href="#removing-a-column-adding-a-column" id="markdown-toc-removing-a-column-adding-a-column">Removing a column, adding a column</a></li> <li><a href="#doesnt-this-take-up-more-space-than-regular-tables-isnt-it-slower-to-query" id="markdown-toc-doesnt-this-take-up-more-space-than-regular-tables-isnt-it-slower-to-query">Doesn’t this take up more space than regular tables? Isn’t it slower to query?</a></li> <li><a href="#improving-performance" id="markdown-toc-improving-performance">Improving performance</a></li> </ul> </li> <li><a href="#what-is-the-best-way-to-load-the-data" id="markdown-toc-what-is-the-best-way-to-load-the-data">What is the best way to load the data?</a></li> <li><a href="#bottom-line" id="markdown-toc-bottom-line">Bottom Line</a></li> <li><a href="#what-are-the-best-tools-to-load-data-like-this" id="markdown-toc-what-are-the-best-tools-to-load-data-like-this">What are the best tools to load data like this?</a></li> <li><a href="#sources" id="markdown-toc-sources">Sources</a></li> </ul> <h2 id="leveraging-semi-structured-data-for-resilience-against-schema-changes">Leveraging semi-structured data for resilience against schema changes</h2> <p>As data warehouse technologies get cheaper and better, ELT is gaining momentum over ETL. In this article we will show you how to leverage Snowflake’s semi-structured data to build integrations that are highly resistant to changes in schema while staying performant. Schema changes are one of the most common things that can break a data pipeline (adding and removing fields, changes in types or length of the data etc.) so it is extremely useful to protect yourself against them.</p> <h2 id="real-world-example--personal-information">Real world example- Personal information</h2> <p>Let’s assume we have a table with basic information about our clients. The goal is to load the information into snowflake unchanged.</p> <table> <thead> <tr> <th>name</th> <th>surname</th> <th>age</th> </tr> </thead> <tbody> <tr> <td>Anne</td> <td>Houston</td> <td>38</td> </tr> <tr> <td>John</td> <td>Doe</td> <td>22</td> </tr> <tr> <td>William</td> <td>Williams</td> <td>27</td> </tr> </tbody> </table> <p>We would usually create the following table in Snowflake:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clients</span> <span class="p">(</span><span class="n">name</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">surname</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">age</span> <span class="n">NUMBER</span><span class="p">);</span>
</code></pre></div></div> <p>Notice how we don’t specify the varchar’s length or the number’s precision and scale. This is preferable because snowflake will automatically use the minimum size needed to store the data efficiently, and if the source system changes the length of a varchar, or the precision of a number your flows won’t break. An exception is when a number has decimals we will need to specify a precision and scale.</p> <p>But if we do that, our integration will fail if a field is removed, and if a field is added we won’t notice. We are not resilient to schema changes. To solve that we will instead create a table with just one variant field where we will load all the data, no matter what fields it has.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">clients_raw</span> <span class="p">(</span><span class="n">src</span> <span class="n">VARIANT</span><span class="p">);</span>
</code></pre></div></div> <p>In order to load the data we can dump it as JSON into a stage.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">FILE</span> <span class="n">FORMAT</span> <span class="n">json_format</span> <span class="k">TYPE</span> <span class="o">=</span> <span class="n">JSON</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="n">STAGE</span> <span class="n">mystage</span> <span class="n">FILE_FORMAT</span> <span class="o">=</span> <span class="n">json_format</span><span class="p">;</span>
</code></pre></div></div> <p>Let’s create a file with some JSON data to load into the table. Run the following in a shell:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'{"name": "Anne", "surname": "Houston", "age": 37}'</span> <span class="o">&gt;</span> /tmp/data.json
<span class="nb">echo</span> <span class="s1">'{"name": "John", "surname": "Doe", "age": 21}'</span> <span class="o">&gt;&gt;</span> /tmp/data.json
<span class="nb">echo</span> <span class="s1">'{"name": "William", "surname": "Williams", "age": 26}'</span> <span class="o">&gt;&gt;</span> /tmp/data.json
</code></pre></div></div> <p>Next we run this in snowflake to upload the data to a stage and then load the data into the table:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">put</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">tmp</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span> <span class="o">@</span><span class="n">mystage</span>
<span class="k">COPY</span> <span class="k">INTO</span> <span class="n">clients_raw</span> <span class="k">FROM</span> <span class="o">@</span><span class="n">mystage</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span> <span class="n">FILE_FORMAT</span> <span class="o">=</span> <span class="n">json_format</span><span class="p">;</span>
</code></pre></div></div> <p>We can now query the data as:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">min</span><span class="p">(</span><span class="n">src</span><span class="p">:</span><span class="n">age</span><span class="p">)</span> <span class="k">as</span> <span class="n">age</span> <span class="k">from</span> <span class="n">clients_raw</span><span class="p">;</span>
</code></pre></div></div> <h3 id="creating-a-view">Creating a view</h3> <p>It is easy to query the data, but it can be verbose and a little confusing to analysts who have never worked with unstructured data. In order to make it transparent to the end user we can create a view that turns it into structured data.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">clients</span> <span class="k">AS</span>
<span class="k">SELECT</span>
<span class="n">src</span><span class="p">:</span><span class="n">name</span><span class="p">::</span><span class="nb">VARCHAR</span> <span class="k">AS</span> <span class="n">name</span><span class="p">,</span>
<span class="n">src</span><span class="p">:</span><span class="n">surname</span><span class="p">::</span><span class="nb">VARCHAR</span> <span class="k">AS</span> <span class="n">surname</span><span class="p">,</span>
<span class="n">src</span><span class="p">:</span><span class="n">age</span><span class="p">::</span><span class="nb">NUMERIC</span> <span class="k">AS</span> <span class="n">age</span>
<span class="k">FROM</span> <span class="n">clients_raw</span><span class="p">;</span>
</code></pre></div></div> <p>The same query from before would now be:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">min</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="k">as</span> <span class="n">age</span> <span class="k">from</span> <span class="n">clients</span><span class="p">;</span>
</code></pre></div></div> <p>And now it’s indistinguishable from a structured table from the user’s point of view.</p> <h3 id="removing-a-column-adding-a-column">Removing a column, adding a column</h3> <p>Suppose that database admins realized that storing age in a column is not ideal, since it needs to be updated every time a client has a birthday. Instead he decides to drop the age column and store a date with their birthday. The new table is as follows:</p> <table> <thead> <tr> <th>name</th> <th>surname</th> <th>birthday</th> </tr> </thead> <tbody> <tr> <td>Anne</td> <td>Houston</td> <td>1984-03-12</td> </tr> <tr> <td>John</td> <td>Doe</td> <td>2000-01-03</td> </tr> <tr> <td>William</td> <td>Williams</td> <td>1995-02-04</td> </tr> </tbody> </table> <p>Let’s create the new data:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'{"name": "Anne", "surname": "Houston", "birthday": "1984-03-12"}'</span> <span class="o">&gt;</span> /tmp/data.json
<span class="nb">echo</span> <span class="s1">'{"name": "John", "surname": "Doe", "birthday": "2000-01-03"}'</span> <span class="o">&gt;&gt;</span> /tmp/data.json
<span class="nb">echo</span> <span class="s1">'{"name": "William", "surname": "Williams", "birthday": "1995-02-04"}'</span> <span class="o">&gt;&gt;</span> /tmp/data.json
</code></pre></div></div> <p>We would usually append the data, but to make this tutorial simple we will just replace the old data with the new one.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">TRUNCATE</span> <span class="k">TABLE</span> <span class="n">clients_raw</span><span class="p">;</span>
<span class="k">COPY</span> <span class="k">INTO</span> <span class="n">clients_raw</span> <span class="k">FROM</span> <span class="o">@</span><span class="n">mystage</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span> <span class="n">FILE_FORMAT</span> <span class="o">=</span> <span class="n">json_format</span><span class="p">;</span>
<span class="n">put</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">tmp</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span> <span class="o">@</span><span class="n">mystage</span><span class="p">;</span>
</code></pre></div></div> <p>Since we store all available data as a variant our integration will not break. The view would not break either, but the age would show as null (try <code class="language-plaintext highlighter-rouge">SELECT * FROM clients</code>). The only thing we need to do to take advantage of the new field is to update the view. For backwards compatibility we will still include the age as a calculation.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">clients</span> <span class="k">AS</span>
<span class="k">SELECT</span>
<span class="n">src</span><span class="p">:</span><span class="n">name</span><span class="p">::</span><span class="nb">VARCHAR</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span>
<span class="n">src</span><span class="p">:</span><span class="n">surname</span><span class="p">::</span><span class="nb">VARCHAR</span> <span class="k">as</span> <span class="n">surname</span><span class="p">,</span>
<span class="n">src</span><span class="p">:</span><span class="n">birthday</span><span class="p">::</span><span class="nb">DATE</span> <span class="k">as</span> <span class="n">birthday</span><span class="p">,</span>
<span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'years'</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span><span class="n">birthday</span><span class="p">,</span> <span class="k">CURRENT_DATE</span><span class="p">())</span> <span class="k">as</span> <span class="n">age</span>
<span class="k">FROM</span> <span class="n">clients_raw</span><span class="p">;</span>
</code></pre></div></div> <p>That’s it, our pipelines never broke and there’s no need to change our data flows or source table definitions!</p> <p>If a new field gets added to the table and no one notices it’s still getting staged into snowflake in the variant so the moment someone requests the field in the view we’ll be able to see it, without needing to backfill the data.</p> <h3 id="doesnt-this-take-up-more-space-than-regular-tables-isnt-it-slower-to-query">Doesn’t this take up more space than regular tables? Isn’t it slower to query?</h3> <p>This excerpt from <a href="https://docs.snowflake.com/en/user-guide/semistructured-considerations.html#storing-semi-structured-data-in-a-variant-column-vs-flattening-the-nested-structure">Snowflake’s docs</a> answers the question:</p> <blockquote> <p>For data that is mostly regular and uses only native types (strings and integers), the storage requirements and query performance for operations on relational data and data in a VARIANT column is very similar. For better pruning and less storage consumption, we recommend flattening your object and key data into separate relational columns if your semi-structured data includes:</p> </blockquote> <ul> <li>Dates and timestamps, especially non-ISO 8601dates and timestamps, as string values</li> <li>Numbers within strings</li> <li>Arrays</li> </ul> <p>Non-native values such as dates and timestamps are stored as strings when loaded into a VARIANT column, so operations on these values could be slower and also consume more space than when stored in a relational column with the corresponding data type.</p> <blockquote> </blockquote> <p>So in terms of performance and storage it should be really similar albeit a little slower. An exception would be if we need to query the birthday because it’s stored as a string, as we will see in the following section.</p> <h3 id="improving-performance">Improving performance</h3> <p>Because variants store dates as strings, they are not as efficient to filter by. This is only an issue if the table is large and you intend to query the table by that date. Let’s see an example of how to improve performance in that case:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">clients_raw</span> <span class="p">(</span><span class="n">src</span> <span class="n">VARIANT</span><span class="p">,</span> <span class="n">birthday</span> <span class="nb">DATE</span><span class="p">);</span>
<span class="k">COPY</span> <span class="k">INTO</span> <span class="n">clients_raw</span> <span class="k">FROM</span> <span class="p">(</span>
<span class="k">select</span>
<span class="err">$</span><span class="mi">1</span> <span class="k">as</span> <span class="n">src</span><span class="p">,</span>
<span class="n">to_date</span><span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">:</span><span class="n">birthday</span><span class="p">)::</span><span class="nb">DATE</span> <span class="k">AS</span> <span class="n">birthday</span>
<span class="k">FROM</span> <span class="o">@</span><span class="n">mystage</span><span class="o">/</span><span class="k">data</span><span class="p">.</span><span class="n">json</span>
<span class="p">)</span> <span class="n">FILE_FORMAT</span> <span class="o">=</span> <span class="n">json_format</span><span class="p">;</span>
</code></pre></div></div> <p>And modify the view:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">clients</span>
<span class="k">SELECT</span>
<span class="n">src</span><span class="p">:</span><span class="n">name</span><span class="p">::</span><span class="nb">VARCHAR</span> <span class="k">as</span> <span class="n">name</span><span class="p">,</span>
<span class="n">src</span><span class="p">:</span><span class="n">surname</span><span class="p">::</span><span class="nb">VARCHAR</span> <span class="k">as</span> <span class="n">surname</span><span class="p">,</span>
<span class="n">birthday</span><span class="p">,</span>     <span class="o">//</span> <span class="o">&lt;</span><span class="c1">-- We changed this to get the column directly</span>
<span class="n">DATEDIFF</span><span class="p">(</span><span class="s1">'years'</span><span class="p">,</span> <span class="n">birthday</span><span class="p">,</span> <span class="k">CURRENT_DATE</span><span class="p">())</span> <span class="k">as</span> <span class="n">age</span>  <span class="o">//</span> <span class="o">&lt;</span><span class="c1">-- Here too</span>
<span class="k">FROM</span> <span class="n">clients_raw</span><span class="p">;</span>
</code></pre></div></div> <p>Now queries filtering by birthday (or getting <code class="language-plaintext highlighter-rouge">MAX(birthday)</code> for example) will be much faster.</p> <h2 id="what-is-the-best-way-to-load-the-data">What is the best way to load the data?</h2> <p>The most efficient way to load the data into a table is by using a COPY command since Snowflake can optimize a bulk load. It can’t do that with insert statements. Here are some of the most popular ways to load the data into snowflake, each with their advantges and disadvantages:</p> <ul> <li>CSV: A gzipped CSV is the fastest way to load structured data into snowflake. It takes more space than parquet. It can also be loaded into a variant column with the right casting (see example later). The data can not be loaded easily into a variant.</li> <li>JSON: Can be easily loaded into a variant, but it takes a lot of space in your data lake.</li> <li>Avro: Built-in schema, easily loaded into a variant or into a structured table. Takes more space than parquet.</li> <li>Parquet: Columnar storage that has a better compression than the other options and can easily be loaded into a structured or unstructured table. It is slower than CSV to load into a structured table.</li> </ul> <h2 id="bottom-line">Bottom Line</h2> <p>Loading data into Snowflake using this method is a great way to save you a lot of headaches and minimise data pipeline failures. It is a good rule of thumb to always use this method unless you will be loading an extremely large amount of data and need the extra 20% performance that a structured table will give you. If you decide to create a structured table instead of using this method be aware that the pipelines will break on any schema change.</p> <h2 id="what-are-the-best-tools-to-load-data-like-this">What are the best tools to load data like this?</h2> <p>Any ETL/ELT tool that is flexible enough, for instance Airflow can be adapted to use this method. You can also check out our ETL tool, <a href="/">Typhoon</a>, that encourages this pattern and other modern best practices for data engineering.</p> <h2 id="sources">Sources</h2> <p><a href="https://www.snowflake.com/wp-content/uploads/2015/06/Snowflake_Semistructured_Data_WP_1_0_062015.pdf">https://www.snowflake.com/wp-content/uploads/2015/06/Snowflake_Semistructured_Data_WP_1_0_062015.pdf</a></p> <p><a href="https://docs.snowflake.com/en/user-guide/semistructured-considerations.html#storing-semi-structured-data-in-a-variant-column-vs-flattening-the-nested-structure">https://docs.snowflake.com/en/user-guide/semistructured-considerations.html#storing-semi-structured-data-in-a-variant-column-vs-flattening-the-nested-structure</a></p> <footer class="post-modified-date"> <p> Updated <time datetime=" 2022-07-17T04:34:46+08:00 "> Sunday, Jul 17, 2022 </time> </p> </footer> </div> </article> </main> <section class="home__posts posts-home"> <div class="posts-home__container"> <h2 id="blog" class="posts-home__title title title_big title_uppercase">BLOG POSTS</h2> <div class="posts-home__body"> <div class="posts-home__item item-posts-left"> <h3 class="posts-home__subtitle subtitle">Getting-started</h3> <div class="posts-home__links"> <section class="list"> <a class="posts-home__link text" href="https://typhoon-data-org.github.io/typhoon-orchestrator/getting-started/installation/" target="_blank">Installation</a> </section> <section class="list"> <a class="posts-home__link text" href="https://typhoon-data-org.github.io/typhoon-orchestrator/examples/hello-world/" target="_blank">Hello World - 5 min walkthrough</a> </section> </div> </div> <div class="posts-home__item item-posts-right posts-home__links"> <h3 class="posts-home__subtitle subtitle">Blog</h3> <section class="list"> <a class="posts-home__link text" href="/typhoon-beta-release.html">Introducing Typhoon beta 🎊</a> </section> <section class="list"> <a class="posts-home__link text" href="/typhoon-orchestrator-vision.html">Why Typhoon?</a> </section> <section class="list"> <a class="posts-home__link text" href="/Airflow.html">Airflow; Standing on the shoulders of giants</a> </section> <section class="list"> <a class="posts-home__link text" href="/Modern-stack.html">Modern data warehouse patterns. ELT with Snowflake variants</a> </section> <section class="list"> <a class="posts-home__link text" href="/serverless-telegram-bot-jokes.html">How to create a Serverless Telegram Bot to send daily jokes to your friends</a> </section> </div> </div> </div> </section> <script></script> <script>function burgerMenu(){const s=document.querySelector(".menu-header__burger-menu"),c=document.querySelector(".menu-header__list"),t=document.querySelector("body");s.addEventListener("click",()=>{c.classList.contains("active")?(c.classList.remove("active"),s.classList.remove("active-burger"),t.classList.remove("locked")):(c.classList.add("active"),s.classList.add("active-burger"),t.classList.add("locked"))}),c.querySelectorAll("li").forEach(e=>e.addEventListener("click",()=>{c.classList.remove("active"),s.classList.remove("active-burger"),t.classList.remove("locked")})),window.addEventListener("resize",()=>{767.98<window.innerWidth&&(c.classList.remove("active"),s.classList.remove("active-burger"),t.classList.remove("locked"))})}burgerMenu()</script> <script>"serviceWorker"in navigator&&"typhoondata.io"===window.location.hostname&&navigator.serviceWorker.register("/service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})</script> <script async="" src="https://www.googletagmanager.com/gtag/js?id=https://www.google-analytics.com/analytics.js"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","https://www.google-analytics.com/analytics.js")</script></body></html>